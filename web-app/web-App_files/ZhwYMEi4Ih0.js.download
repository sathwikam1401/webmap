;/*FB_PKG_DELIM*/

__d("WASmaxInPrivatestatsIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInPrivatestatsIQErrorFeatureNotImplementedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","feature-not-implemented");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",501);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFeatureNotImplementedMixin=a}),98);
__d("WASmaxInPrivatestatsIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",503);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInPrivatestatsIQErrorBadRequestOrFeatureNotImplementedOrServiceUnavailableMixinGroup",["WAResultOrError","WASmaxInPrivatestatsIQErrorBadRequestMixin","WASmaxInPrivatestatsIQErrorFeatureNotImplementedMixin","WASmaxInPrivatestatsIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPrivatestatsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInPrivatestatsIQErrorFeatureNotImplementedMixin").parseIQErrorFeatureNotImplementedMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorFeatureNotImplemented",value:c.value});var e=d("WASmaxInPrivatestatsIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);return e.success?d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorFeatureNotImplemented","IQErrorServiceUnavailable"],[b,c,e])}g.parseIQErrorBadRequestOrFeatureNotImplementedOrServiceUnavailableMixinGroup=a}),98);
__d("WASmaxInPrivatestatsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInPrivatestatsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInPrivatestatsSignCredentialResponseErrorNoRetry",["WAResultOrError","WASmaxInPrivatestatsIQErrorBadRequestOrFeatureNotImplementedOrServiceUnavailableMixinGroup","WASmaxInPrivatestatsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPrivatestatsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPrivatestatsIQErrorBadRequestOrFeatureNotImplementedOrServiceUnavailableMixinGroup").parseIQErrorBadRequestOrFeatureNotImplementedOrServiceUnavailableMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorBadRequestOrFeatureNotImplementedOrServiceUnavailableMixinGroup:b.value}))}g.parseSignCredentialResponseErrorNoRetry=a}),98);
__d("WASmaxInPrivatestatsSignCredentialResponseErrorRetry",["WAResultOrError","WASmaxInPrivatestatsIQErrorInternalServerErrorMixin","WASmaxInPrivatestatsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;c=d("WASmaxInPrivatestatsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(c.value);if(!c.success)return c;a=d("WASmaxInPrivatestatsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorIQErrorInternalServerErrorMixin:c.value},a.value))}g.parseSignCredentialResponseErrorRetry=a}),98);
__d("WASmaxInPrivatestatsSignCredentialResponseSuccess",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"sign_credential");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"signed_credential");if(!e.success)return e;var f=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"acs_public_key");if(!f.success)return f;var g=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"dleq_proof");if(!g.success)return g;var h=d("WASmaxParseUtils").flattenedChildWithTag(g.value,"c");if(!h.success)return h;g=d("WASmaxParseUtils").flattenedChildWithTag(g.value,"s");if(!g.success)return g;var i=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"project_name");if(!i.success)return i;var j=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!j.success)return j;j=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",j.value);if(!j.success)return j;j=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!j.success)return j;b=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",b.value);if(!a.success)return a;b=d("WASmaxParseUtils").attrIntRange(c.value,"t",0,void 0);if(!b.success)return b;a=d("WASmaxParseUtils").contentBytesRange(e.value,32,32);if(!a.success)return a;c=d("WASmaxParseUtils").contentBytesRange(f.value,32,32);if(!c.success)return c;e=d("WASmaxParseUtils").contentBytesRange(h.value,32,32);if(!e.success)return e;f=d("WASmaxParseUtils").contentBytesRange(g.value,32,32);if(!f.success)return f;h=d("WASmaxParseUtils").contentString(i.value);return!h.success?h:d("WAResultOrError").makeResult({type:j.value,signCredentialT:b.value,signCredentialSignedCredentialElementValue:a.value,signCredentialAcsPublicKeyElementValue:c.value,signCredentialDleqProofCElementValue:e.value,signCredentialDleqProofSElementValue:f.value,signCredentialProjectNameElementValue:h.value})}g.parseSignCredentialResponseSuccess=a}),98);
__d("WASmaxOutPrivatestatsSignCredentialRequest",["WASmaxJsx","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b,c=a.blindedCredentialElementValue;a=a.projectNameElementValue;c=(b=d("WASmaxJsx")).smax("iq",{xmlns:"privatestats",id:d("WAWap").generateId(),type:"get",to:d("WAWap").S_WHATSAPP_NET},b.smax("sign_credential",{version:"2"},b.smax("blinded_credential",null,c),b.smax("project_name",null,a)));return c}g.makeSignCredentialRequest=a}),98);
__d("WASmaxPrivatestatsSignCredentialRPC",["WAComms","WASmaxInPrivatestatsSignCredentialResponseErrorNoRetry","WASmaxInPrivatestatsSignCredentialResponseErrorRetry","WASmaxInPrivatestatsSignCredentialResponseSuccess","WASmaxOutPrivatestatsSignCredentialRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutPrivatestatsSignCredentialRequest").makeSignCredentialRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInPrivatestatsSignCredentialResponseSuccess").parseSignCredentialResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"SignCredentialResponseSuccess",value:g.value});case 7:h=d("WASmaxInPrivatestatsSignCredentialResponseErrorNoRetry").parseSignCredentialResponseErrorNoRetry(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"SignCredentialResponseErrorNoRetry",value:h.value});case 10:i=d("WASmaxInPrivatestatsSignCredentialResponseErrorRetry").parseSignCredentialResponseErrorRetry(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"SignCredentialResponseErrorRetry",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("SignCredential",{Success:g,ErrorNoRetry:h,ErrorRetry:i}));case 14:case"end":return j.stop()}},null,this)}g.sendSignCredentialRPC=a}),98);
__d("WAWebCRUDOperationsACSTokens",["WAWebSchemaACSTokens","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){b===void 0&&(b=d("WAWebSchemaACSTokens").getACSTokensTable());return b.createOrReplace(a)}function a(a,b){var c=a+"-default";return h(babelHelpers["extends"]({project:a},b,{tokenName:c}))}function c(a,b){b=b.map(function(b,c){return babelHelpers["extends"]({},b,{project:a,tokenName:a+"-"+c})});return d("WAWebSchemaACSTokens").getACSTokensTable().bulkCreateOrReplace(b)}function i(a,b){b===void 0&&(b=d("WAWebSchemaACSTokens").getACSTokensTable());return b.anyOf(["project"],[a])}function e(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b===void 0&&(b=d("WAWebSchemaACSTokens").getACSTokensTable());a=(yield i(a,b));return a.length>0?a[0]:null});return j.apply(this,arguments)}function f(a){return d("WAWebSchemaACSTokens").getACSTokensTable().get(a)}function k(a,b){b===void 0&&(b=d("WAWebSchemaACSTokens").getACSTokensTable());return b.remove(a)}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield i(a,b));yield b.bulkRemove(a.map(function(a){return a.tokenName}))});return m.apply(this,arguments)}g.upsertACSToken=h;g.storeACSTokenForProject=a;g.storeACSTokensForProject=c;g.getACSTokensByProject=i;g.getACSTokenByProject=e;g.getACSTokenByName=f;g.deleteACSTokenByName=k;g.deleteAllACSTokensByProject=l}),98);
__d("WAWebFetchACSTokens",["WAPromiseRetryLoop","WASmaxPrivatestatsSignCredentialRPC","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=3;function i(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return d("WASmaxPrivatestatsSignCredentialRPC").sendSignCredentialRPC({projectNameElementValue:a,blindedCredentialElementValue:b})});return j.apply(this,arguments)}function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=1,f=function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var d=(yield i(a,c));switch(d.name){case"SignCredentialResponseErrorNoRetry":return b({result:null});case"SignCredentialResponseErrorRetry":e+=1;if(e>h)return b({result:null});return;default:d.name;return b({result:d.value})}});return function(a){return d.apply(this,arguments)}}();f=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"issueACSTokenForProject-"+a,timer:{algo:{type:"exponential",first:250},max:1e3},code:f});f.start();return f.promise()});return k.apply(this,arguments)}g.fetchACSTokenForProject=i;g.fetchACSTokenForProjectWithRetry=a}),98);
__d("WAWebACSTokenConfig",["WATimeUtils","keyMirror"],(function(a,b,c,d,e,f,g){"use strict";var h={WA_StatusMusic:{getMaxRedeemCount:function(){return 50},getMaxExpirySeconds:function(){return d("WATimeUtils").DAY_SECONDS}},WA_StatusMusicReporting:{getMaxRedeemCount:function(){return 50},getMaxExpirySeconds:function(){return d("WATimeUtils").DAY_SECONDS}}};function a(a){return{maxRedeemCount:h[a].getMaxRedeemCount(),maxExpirySeconds:h[a].getMaxExpirySeconds()}}b=c("keyMirror")(h);g.getACSTokenConfig=a;g.ACS_PROJECTS=b}),98);
__d("WAWebACSTokenUtils",["WALogger","WATimeUtils","WAWebACSTokenConfig"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["The "," ACS token was redeemed maximum number of time. The client shall re-issue a new one"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["The "," ACS token expired. The client shall re-issue a new one"]);i=function(){return a};return a}function a(a){var b=a.redeemCount,c=a.creationTs;a=a.projectName;var e=d("WAWebACSTokenConfig").getACSTokenConfig(a),f=e.maxExpirySeconds;e=e.maxRedeemCount;if(!d("WATimeUtils").happenedWithin(c,f)){d("WALogger").LOG(i(),a);return!1}if(b>=e){d("WALogger").LOG(h(),a);return!1}return!0}g.isValidACSToken=a}),98);
__d("WAWebRedeemACSTokenFromStorage",["WAWebACSTokenUtils","WAWebCRUDOperationsACSTokens","WAWebModelStorageUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return d("WAWebModelStorageUtils").getStorage().lock(["acs-tokens"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var c=(yield d("WAWebCRUDOperationsACSTokens").getACSTokensByProject(a,b));if(c.length===0)return null;c=c.filter(function(b){return d("WAWebACSTokenUtils").isValidACSToken({creationTs:b.creationTs,projectName:a,redeemCount:b.redeemCount})});if(c.length===0){yield d("WAWebCRUDOperationsACSTokens").deleteAllACSTokensByProject(a,b);return null}c=i(c);if(c==null)return null;var e=c.redeemCount+1;yield d("WAWebCRUDOperationsACSTokens").upsertACSToken(babelHelpers["extends"]({},c,{redeemCount:e}),b);return c.token});return function(a){return c.apply(this,arguments)}}())});return h.apply(this,arguments)}function i(a){var b=Math.min.apply(Math,a.map(function(a){return a.redeemCount}));return a.find(function(a){return a.redeemCount===b})}g.redeemACSTokenFromStorage=a}),98);
__d("WAWebRedeemACSToken",["Promise","WAACSTokenUtils","WATimeUtils","WAWamPrivateStatsToken","WAWebCRUDOperationsACSTokens","WAWebFetchACSTokens","WAWebRedeemACSTokenFromStorage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=5;function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.projectName;var b=(yield d("WAWebRedeemACSTokenFromStorage").redeemACSTokenFromStorage(a));if(b!=null)return b;b=(yield k(a));if(b.length===0)return;var c=b[0];b=b.slice(1);var e=c.sharedSecret,f=c.token;c=c.t;yield d("WAWebCRUDOperationsACSTokens").storeACSTokenForProject(a,{creationTs:c,redeemCount:1,token:{sharedSecret:e,token:f}});yield d("WAWebCRUDOperationsACSTokens").storeACSTokensForProject(a,b.map(function(c){var a=c.sharedSecret,b=c.token;c=c.t;return{token:{sharedSecret:a,token:b},creationTs:c,redeemCount:0}}));return{sharedSecret:e,token:f}});return j.apply(this,arguments)}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c===void 0&&(c=i);c=Array.from({length:c}).fill().map(function(){return m(a)});c=(yield (h||(h=b("Promise"))).allSettled(c));return c.filter(function(a){return a.status==="fulfilled"}).map(function(a){return a.value}).filter(Boolean)});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAACSTokenUtils").getBlindedToken(),c=b.token,e=b.blindedToken;b=b.blindingFactor;a=(yield d("WAWebFetchACSTokens").fetchACSTokenForProjectWithRetry(a,e));if(a.result==null)return;e=a.result;a=e.signCredentialAcsPublicKeyElementValue;var f=e.signCredentialSignedCredentialElementValue;e=e.signCredentialT;f=d("WAWamPrivateStatsToken").unblindToken(f,b,a);if(f==null)return;b=d("WAACSTokenUtils").getSharedSecret({token:c,unblindedSignedToken:f});return{token:c,sharedSecret:b,t:d("WATimeUtils").castToUnixTime(e)}});return n.apply(this,arguments)}g.redeemACSToken=a}),98);
__d("WAWebRedeemACSCredential",["WABase64","WACryptoHmac","WAWebRedeemACSToken","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b===void 0&&(b=new ArrayBuffer(0));a=(yield d("WAWebRedeemACSToken").redeemACSToken({projectName:a}));if(a==null)return;var c=d("WABase64").encodeB64UrlSafe(a.token,!0);a=(yield d("WACryptoHmac").hmacSha256(a.sharedSecret,b));b=d("WABase64").encodeB64UrlSafe(a,!0);a=c+"+"+b;return a});return h.apply(this,arguments)}g.redeemACSCredential=a}),98);
__d("WAWebACSNetwork",["WAWebHttpExtendedFetch","WAWebRedeemACSCredential","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.url,c=a.project;a=a.data;c=(yield i(c,a));return d("WAWebHttpExtendedFetch").extendedFetch(b,{body:c,method:"POST"})});return h.apply(this,arguments)}function i(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=(yield d("WAWebRedeemACSCredential").redeemACSCredential(a));if(e==null)throw c("err")("Failed to redeem ACS credential");b.set("acs_token",e);b.set("acs_project",a);return b});return j.apply(this,arguments)}g.fetchWithACSCredential=a;g.addACSCredential=i}),98);
__d("WAWebFetchOHAIKeyConfigJobQuery.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"aead_id",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"expiration_date",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"kdf_id",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"kem_id",storageKey:null},e={alias:null,args:null,kind:"ScalarField",name:"key_id",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"last_updated_time",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"public_key",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"WAWebFetchOHAIKeyConfigJobQuery",selections:[{alias:null,args:null,concreteType:"XWA2OHAIConfigsResponse",kind:"LinkedField",name:"xwa2_ohai_configurations",plural:!1,selections:[{alias:null,args:null,concreteType:"XWA2OHAIConfig",kind:"LinkedField",name:"ohai_configs",plural:!0,selections:[{kind:"RequiredField",field:a,action:"THROW",path:"xwa2_ohai_configurations.ohai_configs.aead_id"},{kind:"RequiredField",field:b,action:"THROW",path:"xwa2_ohai_configurations.ohai_configs.expiration_date"},{kind:"RequiredField",field:c,action:"THROW",path:"xwa2_ohai_configurations.ohai_configs.kdf_id"},{kind:"RequiredField",field:d,action:"THROW",path:"xwa2_ohai_configurations.ohai_configs.kem_id"},{kind:"RequiredField",field:e,action:"THROW",path:"xwa2_ohai_configurations.ohai_configs.key_id"},{kind:"RequiredField",field:f,action:"THROW",path:"xwa2_ohai_configurations.ohai_configs.last_updated_time"},{kind:"RequiredField",field:g,action:"THROW",path:"xwa2_ohai_configurations.ohai_configs.public_key"}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"WAWebFetchOHAIKeyConfigJobQuery",selections:[{alias:null,args:null,concreteType:"XWA2OHAIConfigsResponse",kind:"LinkedField",name:"xwa2_ohai_configurations",plural:!1,selections:[{alias:null,args:null,concreteType:"XWA2OHAIConfig",kind:"LinkedField",name:"ohai_configs",plural:!0,selections:[a,b,c,d,e,f,g],storageKey:null}],storageKey:null}]},params:{id:"8611051222276023",metadata:{},name:"WAWebFetchOHAIKeyConfigJobQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("WAWebFetchOHAIKeyConfigJob",["WATimeUtils","WAWebFetchOHAIKeyConfigJobQuery.graphql","WAWebMexClient","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h!==void 0?h:h=b("WAWebFetchOHAIKeyConfigJobQuery.graphql");function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebMexClient").fetchQuery(i,{}));a=(a=a.xwa2_ohai_configurations)==null?void 0:a.ohai_configs;return a==null?null:a.reduce(function(a,b){var c=b.expiration_date,e=b.last_updated_time;c=Number.parseInt(c,10);e=Number.parseInt(e,10);if(!Number.isSafeInteger(c)||!Number.isSafeInteger(e))return a;return a!=null&&a.expirationDate>c?a:{aeadId:b.aead_id,expirationDate:d("WATimeUtils").castToUnixTime(c),kdfId:b.kdf_id,kemId:b.kem_id,keyId:b.key_id,lastUpdatedTime:d("WATimeUtils").castToUnixTime(e),publicKey:b.public_key}},null)});return j.apply(this,arguments)}g.mexFetchOHAIKeyConfig=a}),98);
__d("WAWebOHAIUserPrefs",["WATimeUtils","WAWebUserPrefsKeys","WAWebUserPrefsStore"],(function(a,b,c,d,e,f,g){"use strict";function a(a){c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").UserPrefs.OHAIKeyConfig,a)}function b(){var a=c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").UserPrefs.OHAIKeyConfig);if(a==null||typeof a!=="object")return null;var b=a.aeadId,e=a.kdfId,f=a.kemId,g=a.expirationDate,h=a.keyId,i=a.lastUpdatedTime;a=a.publicKey;return typeof g!=="number"||typeof b!=="number"||typeof e!=="number"||typeof f!=="number"||typeof h!=="number"||typeof i!=="number"||typeof a!=="string"?null:{aeadId:b,kdfId:e,kemId:f,keyId:h,publicKey:a,expirationDate:d("WATimeUtils").castToUnixTime(g),lastUpdatedTime:d("WATimeUtils").castToUnixTime(i)}}g.setOHAIKeyConfig=a;g.getOHAIKeyConfig=b}),98);
__d("WAWebOHAIKeyConfigProvider",["Hpke","WAHex","WALogger","WATimeUtils","WAWebFetchOHAIKeyConfigJob","WAWebNewsletterRpcUtils","WAWebOHAIUserPrefs","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[OHAI] Failed to parse OHAI key config"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[OHAI] Failed to cast OHAI parameters"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[OHAI] Failed to retrieve OHAI key"]);j=function(){return a};return a}var k=60*60;function a(){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield m());if(a==null){d("WALogger").ERROR(j()).sendLogs("ohai-retrieve-failed");return null}var b=d("Hpke").AeadID.cast(a.aeadId),c=d("Hpke").KdfID.cast(a.kdfId),e=d("Hpke").KemID.cast(a.kemId),f=a.keyId;if(b==null||c==null||e==null||f==null){d("WALogger").ERROR(i()).sendLogs("ohai-cast-failed");return null}try{return{aeadId:b,kdfId:c,kemId:e,keyId:f,expirationDate:a.expirationDate,publicKey:new Uint8Array(d("WAHex").parseHex(a.publicKey))}}catch(a){d("WALogger").ERROR(h()).devConsole(a).sendLogs("ohai-parse-failed");return null}});return l.apply(this,arguments)}function m(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("WAWebOHAIUserPrefs").getOHAIKeyConfig();if(a!=null&&o(a))return a;a=(yield d("WAWebNewsletterRpcUtils").runWithBackoff(function(){return d("WAWebFetchOHAIKeyConfigJob").mexFetchOHAIKeyConfig()}));a!=null&&d("WAWebOHAIUserPrefs").setOHAIKeyConfig(a);return a});return n.apply(this,arguments)}function o(a){return a.expirationDate-k>d("WATimeUtils").unixTime()}g.provideOHAIKeyConfig=a}),98);
__d("WAWebOHAIClient",["OhaiClient","WALogger","WAWebABProps","WAWebACSNetwork","WAWebHttpExtendedFetch","WAWebOHAIKeyConfigProvider","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["No OHAI key config available"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid OHAI proxy URL: ",""]);i=function(){return a};return a}var j=new Set(["https://meta-ohttp-relay-prod.fastly-edge.com/"]);function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.url,e=a.project;a=a.payload;var f=(yield d("WAWebOHAIKeyConfigProvider").provideOHAIKeyConfig());if(f==null){d("WALogger").ERROR(h()).sendLogs("failed-to-fetch-ohai-key").tags("ohai");throw c("err")("No OHAI key config available")}e=(yield l({project:e,url:b,payload:a}));b=(yield d("OhaiClient").encapsulateRequest(f,e,!0));a=b.ctx;f=b.enc;e=b.encapsulatedRequest;b=n();b=(yield d("WAWebHttpExtendedFetch").extendedFetch(b,{body:e,headers:{"Content-Type":"message/ohttp-req","Content-Length":e.byteLength.toString()},method:"POST"}));if(!b.ok)return b;e=(yield b.arrayBuffer());b=new Uint8Array(e);return d("OhaiClient").decapsulateResponse(a,f,b)});return k.apply(this,arguments)}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.url,c=a.project;a=a.payload;if(a==null||c==null)return new Request(b);c=(yield d("WAWebACSNetwork").addACSCredential(c,a));return new Request(b,{body:c,method:"POST"})});return m.apply(this,arguments)}function n(){var a=d("WAWebABProps").getABPropConfigValue("music_ohai_proxy_url");a=new URL(a);o(a);return a}function o(a){if(!j.has(a.href)){d("WALogger").ERROR(i(),a.href).sendLogs("ohai-invalid-proxy-"+a.href).tags("ohai");throw c("err")("Invalid OHAI proxy URL")}}g.fetchOHAI=a}),98);
__d("WAWebSNAPLPersistentId",[],(function(a,b,c,d,e,f){"use strict";function a(){return self.crypto.randomUUID()}function b(a){return a}f.computeSNAPLPersistentId=a;f.castToSNAPLPersistentId=b}),66);
__d("WAWebSNAPLUserPrefs",["WAWebSNAPLPersistentId","WAWebUserPrefsKeys","WAWebUserPrefsStore"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").UserPrefs.SNAPLPersistentId,{persistentId:a,mediaId:b})}function a(a){var b=c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").UserPrefs.SNAPLPersistentId);if(b==null||typeof b!=="object")return i(a);var e=b.persistentId;b=b.mediaId;return typeof e!=="string"||typeof b!=="string"?i(a):d("WAWebSNAPLPersistentId").castToSNAPLPersistentId(e)}function i(a){var b=d("WAWebSNAPLPersistentId").computeSNAPLPersistentId();h(b,a);return b}g.getSNAPLPersistentId=a}),98);